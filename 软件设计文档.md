# ç³»ç»Ÿæ¦‚è¿°

## é¡¹ç›®èƒŒæ™¯

è¯¥åšå®¢ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäº**Spring Boot 3.4.5**æ„å»ºçš„åç«¯APIæœåŠ¡ï¼Œé‡‡ç”¨æ ‡å‡†çš„MVCæ¶æ„æ¨¡å¼ï¼Œæä¾›å®Œæ•´çš„åšå®¢æ–‡ç« ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ–‡ç« çš„å¢åˆ æ”¹æŸ¥ã€å›¾ç‰‡ç®¡ç†ã€é…ç½®ç®¡ç†ä»¥åŠLLMï¼ˆå¤§è¯­è¨€æ¨¡å‹ï¼‰é›†æˆç­‰åŠŸèƒ½ã€‚

## æŠ€æœ¯æ ˆ

Spring Boot 3.4.5ã€Java 17ã€Spring Webã€Spring WebFluxã€SnakeYAMLã€Gsonã€Maven

## ç³»ç»Ÿç‰¹ç‚¹

* **RESTful APIè®¾è®¡** ï¼šéµå¾ªRESTæ¶æ„é£æ ¼ï¼Œæä¾›æ ‡å‡†åŒ–çš„HTTPæ¥å£
* **æ–‡ä»¶å­˜å‚¨** ï¼šé‡‡ç”¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ï¼Œæ”¯æŒMarkdownæ ¼å¼æ–‡ç« 
* **é…ç½®ç®¡ç†** ï¼šæ”¯æŒåŠ¨æ€é…ç½®åŠ è½½å’Œæ›´æ–°
* **LLMé›†æˆ** ï¼šé›†æˆå¤šç§å¤§è¯­è¨€æ¨¡å‹APIï¼Œæ”¯æŒæ™ºèƒ½å†…å®¹ç”Ÿæˆ
* **æµå¼å“åº”** ï¼šæ”¯æŒServer-Sent Events(SSE)å®ç°å®æ—¶æ•°æ®æ¨é€

# ç³»ç»Ÿæ¶æ„åˆ†æ

## Mavenæ„å»ºå·¥å…·

Maven æ˜¯ä¸€ä¸ª **åŸºäº POMï¼ˆProject Object Modelï¼‰** çš„æ„å»ºå·¥å…·ï¼Œå®ƒé€šè¿‡ä¸€ä¸ª `pom.xml` æ–‡ä»¶æ¥ç®¡ç†é¡¹ç›®çš„é…ç½®ï¼ŒåŒ…æ‹¬ä¾èµ–ã€æ’ä»¶ã€æ„å»ºæµç¨‹ç­‰ã€‚æœ¬é¡¹ç›®ä½¿ç”¨mavenä½œä¸ºæ„å»ºå·¥å…·ï¼Œç®€åŒ–ç¯å¢ƒé…ç½®ï¼Œä¾èµ–æ³¨å…¥ï¼Œé¡¹ç›®æ‰“åŒ…ç­‰æµç¨‹ã€‚

Mavençš„ä½œç”¨åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š

* **ä¾èµ–ç®¡ç†** ï¼šè‡ªåŠ¨ä¸‹è½½å¹¶ç®¡ç†é¡¹ç›®æ‰€éœ€çš„ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚JUnit,Spring,MySQLé©±åŠ¨ï¼‰ï¼Œé¿å…æ‰‹åŠ¨å¼•å…¥jaråŒ…ã€‚
* JaråŒ…ï¼šç”¨äºæ‰“åŒ…Javaç±»ã€èµ„æºæ–‡ä»¶å’Œå…ƒæ•°æ®çš„å‹ç¼©æ–‡ä»¶æ ¼å¼ã€‚
* **æ ‡å‡†åŒ–é¡¹ç›®ç»“æ„** ï¼šMaven æå€¡ç»Ÿä¸€çš„é¡¹ç›®ç›®å½•ç»“æ„ï¼Œå…³äºå…·ä½“çš„ç»“æ„æˆ‘ä»¬ä¸‹é¢å†è®²ã€‚
* **æ„å»ºè‡ªåŠ¨åŒ–** ï¼šä¸€æ¡å‘½ä»¤å³å¯å®Œæˆç¼–è¯‘ã€æµ‹è¯•ã€æ‰“åŒ…ã€å®‰è£…ã€éƒ¨ç½²ç­‰æµç¨‹ã€‚
* **æ’ä»¶æœºåˆ¶** ï¼šæ”¯æŒä¸°å¯Œçš„æ’ä»¶ã€‚

## MVCè½¯ä»¶æ¶æ„æ¨¡å¼

**MVCæ¨¡å¼**(Model-View-Controller)æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„æ¨¡å¼ï¼Œè¢«å¹¿æ³›åº”ç”¨äºWebå¼€å‘å’Œæ¡Œé¢åº”ç”¨å¼€å‘ä¸­ã€‚å®ƒé€šè¿‡å°†åº”ç”¨ç¨‹åºåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œä½¿å¾—ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤å’Œæ‰©å±•ã€‚æœ¬é¡¹ç›®ä½¿ç”¨Springï¼ŒSpringMVCã€SpringBootæ¡†æ¶è¿›è¡Œé¡¹ç›®åç«¯å¼€å‘ï¼Œä½¿ç”¨Vue3æ¡†æ¶è¿›è¡Œå‰ç«¯å¼€å‘ã€‚APIæ¥å£éµå¾ª**RESTful API**è®¾è®¡è§„èŒƒã€‚

ç³»ç»Ÿæ¶æ„æ€»è§ˆï¼š

![1749452353464](image/è½¯ä»¶è®¾è®¡æ–‡æ¡£/1749452353464.png)

## Spring åˆ†å±‚æ¶æ„

Springä¸­ï¼Œæ¯ä¸€å±‚çš„ä½œç”¨æ˜¯ä¸ºäº†å®ç°åº”ç”¨çš„åˆ†å±‚æ¶æ„ï¼Œéµå¾ªå•ä¸€èŒè´£åŸåˆ™ï¼Œä½¿ä»£ç æ›´æ˜“äºç»´æŠ¤ã€æµ‹è¯•å’Œæ‰©å±•ã€‚ä»¥ä¸‹æ˜¯å„å±‚çš„ä½œç”¨è¯´æ˜ä»¥åŠå¦‚ä½•ç»„ç»‡ä»£ç çš„è¯´æ˜ã€‚

### å¯åŠ¨ç±»(BlogManagerApplication)

ä½œç”¨ï¼š

* é¡¹ç›®çš„å…¥å£ï¼Œè´Ÿè´£å¯åŠ¨SpringBootåº”ç”¨ã€‚
* åˆå§‹åŒ–Springå®¹å™¨ï¼Œå¹¶åŠ è½½æ‰€æœ‰çš„é…ç½®å’ŒBeanã€‚

> Bean æ˜¯ç”± Spring å®¹å™¨ç®¡ç†çš„å¯¹è±¡ï¼Œç”¨äºå®ç°ä¾èµ–æ³¨å…¥å’Œç»„ä»¶åŒ–ç®¡ç†ï¼Œæ˜¯åº”ç”¨ç¨‹åºçš„æ ¸å¿ƒæ„å»ºæ¨¡å—ã€‚

### æ§åˆ¶å™¨å±‚(Controller)

ä½œç”¨ï¼š

* æ¥æ”¶ç”¨æˆ·çš„HTTPè¯·æ±‚å¹¶è¿”å›å“åº”ã€‚
* å¤„ç†è¯·æ±‚å‚æ•°å’Œè°ƒç”¨æœåŠ¡å±‚ã€‚
* æ˜¯åº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ï¼Œè´Ÿè´£å°†ç”¨æˆ·è¾“å…¥ä¼ é€’ç»™æœåŠ¡å±‚ã€‚
* ä½¿ç”¨ `@RestController` è¿”å›Jsonï¼Œæˆ– `@Controller`è¿”å›è§†å›¾ã€‚

> **èŒè´£** ï¼šå¤„ç†HTTPè¯·æ±‚ï¼Œå‚æ•°éªŒè¯ï¼Œå“åº”æ ¼å¼åŒ–
>
> **ç»„ä»¶** ï¼šBlogController, ConfigController, ImageController, LLMController
>
> **ç‰¹ç‚¹** ï¼šé‡‡ç”¨@RestControlleræ³¨è§£ï¼Œæ”¯æŒRESTful APIè®¾è®¡ï¼Œç»Ÿä¸€è¿”å›Messageå¯¹è±¡

### æœåŠ¡å±‚(Service)

ä½œç”¨ï¼š

* å°è£…ä¸šåŠ¡é€»è¾‘
* è°ƒç”¨æ•°æ®è®¿é—®å±‚å¤„ç†æ•°æ®ï¼Œå¹¶å°†ç»“æœè¿”å›ç»™Controllerã€‚
* æ˜¯ä¸šåŠ¡è§„åˆ™å®ç°çš„æ ¸å¿ƒï¼Œç‹¬ç«‹äºæ§åˆ¶å™¨å’Œæ•°æ®è®¿é—®å±‚ã€‚

> **èŒè´£** ï¼šä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œäº‹åŠ¡ç®¡ç†ï¼Œä¸šåŠ¡è§„åˆ™å®ç°
>
> **ç»„ä»¶** ï¼šConfigService, LLMç›¸å…³æœåŠ¡
>
> **ç‰¹ç‚¹** ï¼šä½¿ç”¨@Serviceæ³¨è§£ï¼Œå®ç°å…·ä½“ä¸šåŠ¡é€»è¾‘

### æ•°æ®è®¿é—®å±‚(Respository)

ä½œç”¨ï¼š

* è´Ÿè´£ä¸æ•°æ®åº“äº¤äº’ï¼Œæ‰§è¡Œ**CRUD**æ“ä½œã€‚
* ä½¿ç”¨Spring Data JPA æˆ–å…¶ä»–æŒä¹…åŒ–å·¥å…·
* æ•°æ®è®¿é—®å±‚åªå…³å¿ƒæ•°æ®çš„å­˜å‚¨å’Œæ£€ç´¢ï¼Œä¸å…³å¿ƒå…¶ä»–ä¸šåŠ¡é€»è¾‘ã€‚

> * CRUDï¼šå³åˆ›å»º(Create)ã€è¯»å–(Read)ã€æ›´æ–°(Update)ã€åˆ é™¤(Delete)ã€‚
> * æŒä¹…åŒ–ï¼šå°†åº”ç”¨ç¨‹åºå¯¹è±¡çš„çŠ¶æ€ä¿å­˜åˆ°æ•°æ®åº“çš„è¿‡ç¨‹ã€‚

### å®ä½“ç±»(Model)

ä½œç”¨ï¼š

* å®šä¹‰æ•°æ®åº“è¡¨å¯¹åº”çš„å®ä½“
* ç”¨äºå°è£…æ•°æ®(é€šå¸¸æ˜¯ä¸šåŠ¡æ•°æ®)
* ä½¿ç”¨JPAæ³¨è§£(å¦‚ `@Entity`ï¼Œ`@Id`ï¼Œ`@Column`)å®šä¹‰å®ä½“å’Œæ•°æ®åº“è¡¨çš„æ˜ å°„å…³ç³»ã€‚

> **ç»„ä»¶**ï¼šBlog.javaã€Message.java

# è®¾è®¡æ¨¡å¼åˆ†æ

## MVC(Model-View-Controller)æ¨¡å¼

åšå®¢ç®¡ç†ç³»ç»Ÿä¸¥æ ¼éµå¾ªSpring Bootçš„MVCæ¶æ„æ¨¡å¼ï¼Œå°†åº”ç”¨ç¨‹åºåˆ†ä¸ºä¸‰ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š

![1749455675191](image/è½¯ä»¶è®¾è®¡æ–‡æ¡£/1749455675191.png)

```java
Controller å±‚ç¤ºä¾‹ (BlogController.java):
@RestController
@RequestMapping("/api/blogs")
public class BlogController {
    @Autowired
    private BlogFileService blogFileService;

    @GetMapping("/lists")
    public Message listBlogFilenames() {
        // è°ƒç”¨Serviceå±‚å¤„ç†ä¸šåŠ¡é€»è¾‘
        this.blogList = blogFileService.listPostFilenames();
        return new Message(0, blogList, null);
    }
}
```

#### âœ… ä¼˜åŠ¿

* **å…³æ³¨ç‚¹åˆ†ç¦»** ï¼šä¸šåŠ¡é€»è¾‘ã€æ•°æ®æ¨¡å‹å’Œè¡¨ç¤ºå±‚å®Œå…¨è§£è€¦
* **å¯ç»´æŠ¤æ€§** ï¼šä¿®æ”¹æŸä¸€å±‚ä¸ä¼šå½±å“å…¶ä»–å±‚çš„å®ç°
* **å¯æµ‹è¯•æ€§** ï¼šæ¯å±‚éƒ½å¯ä»¥ç‹¬ç«‹è¿›è¡Œå•å…ƒæµ‹è¯•
* **å›¢é˜Ÿåä½œ** ï¼šå‰åç«¯å¼€å‘äººå‘˜å¯ä»¥å¹¶è¡Œå·¥ä½œ
* **ä»£ç å¤ç”¨** ï¼šServiceå±‚å¯ä»¥è¢«å¤šä¸ªControllerå¤ç”¨

#### ğŸ”§ ç‰¹ç‚¹

* **å•ä¸€èŒè´£** ï¼šæ¯ä¸ªç»„ä»¶åªè´Ÿè´£è‡ªå·±çš„æ ¸å¿ƒåŠŸèƒ½
* **æ¾è€¦åˆ** ï¼šé€šè¿‡ä¾èµ–æ³¨å…¥å®ç°ç»„ä»¶é—´çš„æ¾è€¦åˆ
* **å±‚æ¬¡æ¸…æ™°** ï¼šæ˜ç¡®çš„åˆ†å±‚ç»“æ„ä¾¿äºç†è§£å’Œç»´æŠ¤
* **RESTfulè®¾è®¡** ï¼šControlleræä¾›æ ‡å‡†çš„REST APIæ¥å£

#### ğŸ¯ è§£å†³çš„é—®é¢˜

* **ä»£ç æ··ä¹±** ï¼šé¿å…å°†ä¸šåŠ¡é€»è¾‘ã€æ•°æ®è®¿é—®å’Œè§†å›¾æ¸²æŸ“æ··åœ¨ä¸€èµ·
* **éš¾ä»¥ç»´æŠ¤** ï¼šé€šè¿‡åˆ†å±‚é™ä½ç³»ç»Ÿå¤æ‚åº¦
* **ä»£ç é‡å¤** ï¼šServiceå±‚å¤ç”¨é¿å…é‡å¤çš„ä¸šåŠ¡é€»è¾‘
* **æµ‹è¯•å›°éš¾** ï¼šåˆ†å±‚è®¾è®¡ä½¿å¾—å•å…ƒæµ‹è¯•æ›´å®¹æ˜“è¿›è¡Œ

## å·¥å‚æ¨¡å¼(Factory Pattern)

ç³»ç»Ÿä½¿ç”¨å·¥å‚æ¨¡å¼æ¥åˆ›å»ºä¸åŒç±»å‹çš„LLM (Large Language Model) å®ä¾‹ï¼Œæ”¯æŒXModelå’ŒBigModelä¸¤ç§ä¸åŒçš„AIæœåŠ¡æä¾›å•†ï¼š

![1749455845774](image/è½¯ä»¶è®¾è®¡æ–‡æ¡£/1749455845774.png)

```java
å·¥å‚æ¥å£å®šä¹‰ (FactoryInterface.java):
public interface FactoryInterface {
    LLM createLLM();
}

å…·ä½“å·¥å‚å®ç° (BigModelFactory.java):
public class BigModelFactory implements FactoryInterface {
    private String APIKey;
    private final String APIUrl = "https://open.bigmodel.cn/api/paas/v4/chat/completions";

    public BigModelFactory(Config config) {
        this.APIKey = config.getBigmodelAPIKey();
    }

    @Override
    public LLM createLLM() {
        return new BigModel(APIKey, APIUrl, model);
    }
}
```

#### âœ… ä¼˜åŠ¿

* **æ‰©å±•æ€§** ï¼šæ·»åŠ æ–°çš„LLMæä¾›å•†åªéœ€æ–°å¢å·¥å‚ç±»ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 
* **å°è£…åˆ›å»ºé€»è¾‘** ï¼šéšè—å¤æ‚çš„å¯¹è±¡åˆ›å»ºè¿‡ç¨‹å’Œå‚æ•°é…ç½®
* **ç»Ÿä¸€æ¥å£** ï¼šå®¢æˆ·ç«¯é€šè¿‡ç»Ÿä¸€çš„æ¥å£è·å–ä¸åŒç±»å‹çš„LLMå®ä¾‹
* **é™ä½è€¦åˆ** ï¼šå®¢æˆ·ç«¯ä»£ç ä¸ç›´æ¥ä¾èµ–å…·ä½“çš„LLMå®ç°ç±»

#### ğŸ”§ ç‰¹ç‚¹

* **å¤šæ€æ€§** ï¼šåŸºäºæ¥å£çš„è®¾è®¡æ”¯æŒè¿è¡Œæ—¶åˆ‡æ¢ä¸åŒçš„å·¥å‚
* **é…ç½®é©±åŠ¨** ï¼šé€šè¿‡Configå¯¹è±¡ä¼ é€’ä¸åŒçš„APIå¯†é’¥å’Œé…ç½®
* **å»¶è¿Ÿå®ä¾‹åŒ–** ï¼šåªæœ‰åœ¨éœ€è¦æ—¶æ‰åˆ›å»ºLLMå®ä¾‹
* **å‚æ•°å°è£…** ï¼šå°†å¤æ‚çš„APIå‚æ•°å°è£…åœ¨å·¥å‚å†…éƒ¨

#### ğŸ¯ è§£å†³çš„é—®é¢˜

* **ç¡¬ç¼–ç ä¾èµ–** ï¼šé¿å…åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­ç¡¬ç¼–ç å…·ä½“çš„LLMç±»å‹
* **åˆ›å»ºå¤æ‚æ€§** ï¼šç®€åŒ–LLMå®ä¾‹çš„åˆ›å»ºè¿‡ç¨‹
* **é…ç½®ç®¡ç†** ï¼šé›†ä¸­ç®¡ç†ä¸åŒLLMçš„é…ç½®å‚æ•°
* **ç±»å‹åˆ‡æ¢** ï¼šè¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©ä¸åŒçš„AIæœåŠ¡æä¾›å•†

## æ¨¡æ¿æ–¹æ³•æ¨¡å¼(Template Method Pattern)

LLMæŠ½è±¡ç±»å®šä¹‰äº†è°ƒç”¨AIæœåŠ¡çš„åŸºæœ¬æµç¨‹å’Œé€šç”¨å±æ€§ï¼Œå…·ä½“çš„LLMå®ç°ç±»é‡å†™å…³é”®çš„è°ƒç”¨æ–¹æ³•ï¼š

![1749455916277](image/è½¯ä»¶è®¾è®¡æ–‡æ¡£/1749455916277.png)

```java
æŠ½è±¡æ¨¡æ¿ç±» (LLM.java):
public abstract class LLM {
    // é€šç”¨å±æ€§å’Œæ–¹æ³•
    private String APIKey;
    private String APIUrl;
    private String model;
    protected ArrayList<POSTMessage> messagesArray;

    // æ„é€ å‡½æ•°å®šä¹‰é€šç”¨åˆå§‹åŒ–æµç¨‹
    public LLM(String APIKey, String APIUrl, String model) {
        this.APIKey = APIKey;
        this.APIUrl = APIUrl;
        this.model = model;
        this.messagesArray = new ArrayList<>();
    }

    // æŠ½è±¡æ–¹æ³•ï¼Œå­ç±»å¿…é¡»å®ç°
    public abstract void callLLM(String prompt, String content, StreamCallback callback);
}
```

#### âœ… ä¼˜åŠ¿

* **ä»£ç å¤ç”¨** ï¼šé€šç”¨çš„åˆå§‹åŒ–é€»è¾‘å’Œå±æ€§ç®¡ç†åœ¨åŸºç±»ä¸­å®ç°
* **ä¸€è‡´æ€§** ï¼šç¡®ä¿æ‰€æœ‰LLMå®ç°éƒ½éµå¾ªç›¸åŒçš„åŸºæœ¬ç»“æ„
* **æ‰©å±•æ€§** ï¼šæ–°å¢LLMç±»å‹åªéœ€ç»§æ‰¿å¹¶å®ç°æŠ½è±¡æ–¹æ³•
* **ç»´æŠ¤æ€§** ï¼šé€šç”¨åŠŸèƒ½çš„ä¿®æ”¹åªéœ€åœ¨åŸºç±»ä¸­è¿›è¡Œ

#### ğŸ”§ ç‰¹ç‚¹

* **éª¨æ¶å®šä¹‰** ï¼šæŠ½è±¡ç±»å®šä¹‰äº†LLMæœåŠ¡çš„åŸºæœ¬éª¨æ¶
* **é’©å­æ–¹æ³•** ï¼šcallLLMæ–¹æ³•ä½œä¸ºé’©å­æ–¹æ³•ç”±å­ç±»å®ç°
* **ä¸å˜éƒ¨åˆ†** ï¼šå…¬å…±å±æ€§å’Œgetter/setteræ–¹æ³•ä¿æŒä¸å˜
* **å¯å˜éƒ¨åˆ†** ï¼šå…·ä½“çš„APIè°ƒç”¨é€»è¾‘ç”±å­ç±»å®šåˆ¶

#### ğŸ¯ è§£å†³çš„é—®é¢˜

* **ä»£ç é‡å¤** ï¼šé¿å…åœ¨æ¯ä¸ªLLMå®ç°ä¸­é‡å¤ç›¸åŒçš„åŸºç¡€ä»£ç 
* **ç»“æ„ä¸ä¸€è‡´** ï¼šç»Ÿä¸€ä¸åŒLLMå®ç°çš„åŸºæœ¬ç»“æ„
* **ç»´æŠ¤å›°éš¾** ï¼šé›†ä¸­ç®¡ç†é€šç”¨åŠŸèƒ½ï¼Œä¾¿äºç»´æŠ¤å’Œå‡çº§
* **æ‰©å±•å¤æ‚** ï¼šç®€åŒ–æ–°LLMç±»å‹çš„æ¥å…¥è¿‡ç¨‹

## è§‚å¯Ÿè€…æ¨¡å¼(Observer Pattern)

é€šè¿‡StreamCallbackæ¥å£å®ç°è§‚å¯Ÿè€…æ¨¡å¼ï¼Œå¤„ç†LLM APIçš„æµå¼å“åº”ï¼Œå®ç°å®æ—¶æ•°æ®æ¨é€ï¼š

![1749455979961](image/è½¯ä»¶è®¾è®¡æ–‡æ¡£/1749455979961.png)

```java
è§‚å¯Ÿè€…æ¥å£ (StreamCallback.java):
public interface StreamCallback {
    /**
     * å¤„ç†æµå¼è¾“å‡ºçš„å›è°ƒæ–¹æ³•
     */
    void onResponse(String chunk, boolean isDone);

    /**
     * é”™è¯¯å¤„ç†å›è°ƒæ–¹æ³•
     */
    void onError(String error);
}

è§‚å¯Ÿè€…å®ç° (LLMController.java):
StreamCallback callback = new StreamCallback() {
    @Override
    public void onResponse(String chunk, boolean isDone) {
        responseText.append(chunk);
        // å®æ—¶å¤„ç†æµå¼æ•°æ®
    }

    @Override
    public void onError(String error) {
        logger.error("è·å–å»ºè®®æ—¶å‘ç”Ÿé”™è¯¯: " + error);
    }
};
```

#### âœ… ä¼˜åŠ¿

* **å®æ—¶å“åº”** ï¼šæ”¯æŒæµå¼æ•°æ®çš„å®æ—¶å¤„ç†å’Œæ¨é€
* **æ¾è€¦åˆ** ï¼šLLMæœåŠ¡å’Œå“åº”å¤„ç†é€»è¾‘å®Œå…¨è§£è€¦
* **å¼‚æ­¥å¤„ç†** ï¼šæ”¯æŒå¼‚æ­¥çš„æ•°æ®æµå¤„ç†
* **é”™è¯¯å¤„ç†** ï¼šç»Ÿä¸€çš„é”™è¯¯é€šçŸ¥æœºåˆ¶
* **æ‰©å±•æ€§** ï¼šå¯ä»¥è½»æ¾æ·»åŠ å¤šä¸ªè§‚å¯Ÿè€…å¤„ç†ä¸åŒç±»å‹çš„å“åº”

#### ğŸ”§ ç‰¹ç‚¹

* **äº‹ä»¶é©±åŠ¨** ï¼šåŸºäºå›è°ƒçš„äº‹ä»¶é©±åŠ¨æ¶æ„
* **çŠ¶æ€é€šçŸ¥** ï¼šé€šè¿‡isDoneå‚æ•°é€šçŸ¥æµå¤„ç†çŠ¶æ€
* **é”™è¯¯ä¼ æ’­** ï¼šç»Ÿä¸€çš„é”™è¯¯ä¼ æ’­æœºåˆ¶
* **æ¥å£çº¦å®š** ï¼šé€šè¿‡æ¥å£å®šä¹‰æ ‡å‡†çš„é€šçŸ¥åè®®

#### ğŸ¯ è§£å†³çš„é—®é¢˜

* **é˜»å¡ç­‰å¾…** ï¼šé¿å…åŒæ­¥ç­‰å¾…é•¿æ—¶é—´çš„AIå“åº”
* **ç”¨æˆ·ä½“éªŒ** ï¼šæä¾›æµå¼å“åº”æ”¹å–„ç”¨æˆ·ä½“éªŒ
* **èµ„æºå ç”¨** ï¼šå‡å°‘é•¿è¿æ¥çš„èµ„æºå ç”¨
* **å“åº”å¤„ç†** ï¼šçµæ´»å¤„ç†ä¸åŒç±»å‹çš„å“åº”æ•°æ®

## å•ä¾‹æ¨¡å¼(Singleton Pattern)

è™½ç„¶é¡¹ç›®ä¸­æ²¡æœ‰æ˜¾å¼çš„å•ä¾‹ç±»ï¼Œä½†Springæ¡†æ¶çš„Beanç®¡ç†å®é™…ä¸Šå®ç°äº†å•ä¾‹æ¨¡å¼ã€‚ConfigServiceã€BlogFileServiceç­‰æœåŠ¡ç±»éƒ½æ˜¯å•ä¾‹Beanï¼š

![1749456047077](image/è½¯ä»¶è®¾è®¡æ–‡æ¡£/1749456047077.png)

```java
Springç®¡ç†çš„å•ä¾‹Bean (ConfigService.java):
@Configuration
public class ConfigService {
    // Springç¡®ä¿è¿™ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹
    private Path configPath;
    private Config config;

    @PostConstruct
    public void loadConfig() {
        // åˆå§‹åŒ–é…ç½®ï¼Œå…¨å±€å…±äº«
    }
}

æœåŠ¡å±‚å•ä¾‹ (BlogFileService.java):
@Service
public class BlogFileService {
    // Springå®¹å™¨ç®¡ç†çš„å•ä¾‹æœåŠ¡
    private final Path storageLocation;
    private Config config;

    @Autowired
    public BlogFileService(Config config) {
        // ä¾èµ–æ³¨å…¥å•ä¾‹é…ç½®
    }
}
```

#### âœ… ä¼˜åŠ¿

* **å†…å­˜æ•ˆç‡** ï¼šå‡å°‘å¯¹è±¡åˆ›å»ºï¼ŒèŠ‚çœå†…å­˜èµ„æº
* **å…¨å±€è®¿é—®** ï¼šæä¾›å…¨å±€å”¯ä¸€çš„é…ç½®å’ŒæœåŠ¡å®ä¾‹
* **çŠ¶æ€å…±äº«** ï¼šåœ¨æ•´ä¸ªåº”ç”¨ä¸­å…±äº«é…ç½®å’ŒçŠ¶æ€ä¿¡æ¯
* **ç”Ÿå‘½å‘¨æœŸç®¡ç†** ï¼šSpringå®¹å™¨è‡ªåŠ¨ç®¡ç†Beançš„ç”Ÿå‘½å‘¨æœŸ
* **çº¿ç¨‹å®‰å…¨** ï¼šSpringç¡®ä¿Beanåˆ›å»ºè¿‡ç¨‹çš„çº¿ç¨‹å®‰å…¨

#### ğŸ”§ ç‰¹ç‚¹

* **å®¹å™¨ç®¡ç†** ï¼šç”±Spring IoCå®¹å™¨è´Ÿè´£å•ä¾‹ç®¡ç†
* **æ‡’åŠ è½½** ï¼šæ”¯æŒæ‡’åŠ è½½å’Œæå‰åˆå§‹åŒ–
* **ä¾èµ–æ³¨å…¥** ï¼šé€šè¿‡@Autowiredå®ç°ä¾èµ–æ³¨å…¥
* **é…ç½®é©±åŠ¨** ï¼šé€šè¿‡æ³¨è§£é…ç½®å•ä¾‹è¡Œä¸º

#### ğŸ¯ è§£å†³çš„é—®é¢˜

* **èµ„æºæµªè´¹** ï¼šé¿å…é‡å¤åˆ›å»ºç›¸åŒçš„æœåŠ¡å®ä¾‹
* **é…ç½®ç®¡ç†** ï¼šå…¨å±€ç»Ÿä¸€çš„é…ç½®ç®¡ç†
* **çŠ¶æ€ä¸€è‡´æ€§** ï¼šç¡®ä¿åº”ç”¨çŠ¶æ€çš„ä¸€è‡´æ€§
* **åˆå§‹åŒ–å¼€é”€** ï¼šå‡å°‘é‡å¤çš„åˆå§‹åŒ–å¼€é”€

## ç­–ç•¥æ¨¡å¼(Strategy Pattern)

LLMControllerä¸­æ ¹æ®ç”¨æˆ·é€‰æ‹©åŠ¨æ€åˆ‡æ¢ä¸åŒçš„LLMæœåŠ¡æä¾›å•†ï¼Œä½“ç°äº†ç­–ç•¥æ¨¡å¼çš„åº”ç”¨ï¼š

![1749456102631](image/è½¯ä»¶è®¾è®¡æ–‡æ¡£/1749456102631.png)

```java
ç­–ç•¥ä¸Šä¸‹æ–‡ (LLMController.java):
@RestController
public class LLMController {
    private LLM llm; // ç­–ç•¥æ¥å£å¼•ç”¨

    @RequestMapping("/set")
    public void getLlm(@RequestParam String llmType) {
        switch (llmType) {
            case "XModel":
                XModelFactory factory = new XModelFactory(config);
                llm = factory.createLLM(); // åŠ¨æ€ç­–ç•¥é€‰æ‹©
                break;
            case "BigModel":
                BigModelFactory bigModelFactory = new BigModelFactory(config);
                llm = bigModelFactory.createLLM();
                break;
        }
    }

    // ä½¿ç”¨é€‰å®šçš„ç­–ç•¥
    public void processRequest() {
        llm.callLLM(prompt, content, callback);
    }
}
```

#### âœ… ä¼˜åŠ¿

* **è¿è¡Œæ—¶åˆ‡æ¢** ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢ä¸åŒçš„AIæœåŠ¡æä¾›å•†
* **ç®—æ³•ç‹¬ç«‹** ï¼šä¸åŒLLMçš„å®ç°ç®—æ³•å®Œå…¨ç‹¬ç«‹
* **æ˜“äºæ‰©å±•** ï¼šæ·»åŠ æ–°çš„LLMç±»å‹ä¸éœ€è¦ä¿®æ”¹ç°æœ‰ä»£ç 
* **æ¶ˆé™¤æ¡ä»¶è¯­å¥** ï¼šé¿å…å¤§é‡çš„if-elseæˆ–switchè¯­å¥
* **æµ‹è¯•å‹å¥½** ï¼šå¯ä»¥è½»æ¾æµ‹è¯•ä¸åŒçš„ç­–ç•¥å®ç°

#### ğŸ”§ ç‰¹ç‚¹

* **ç­–ç•¥å°è£…** ï¼šæ¯ä¸ªLLMå®ç°éƒ½å°è£…äº†ç‰¹å®šçš„è°ƒç”¨ç­–ç•¥
* **ä¸Šä¸‹æ–‡æ— å…³** ï¼šç­–ç•¥å®ç°ä¸ä¾èµ–ç‰¹å®šçš„ä¸Šä¸‹æ–‡
* **å·¥å‚ç»“åˆ** ï¼šä¸å·¥å‚æ¨¡å¼ç»“åˆåˆ›å»ºç­–ç•¥å®ä¾‹
* **é…ç½®é©±åŠ¨** ï¼šåŸºäºç”¨æˆ·é…ç½®é€‰æ‹©åˆé€‚çš„ç­–ç•¥

#### ğŸ¯ è§£å†³çš„é—®é¢˜

* **ç¡¬ç¼–ç ç®—æ³•** ï¼šé¿å…å°†å…·ä½“çš„LLMè°ƒç”¨é€»è¾‘ç¡¬ç¼–ç 
* **æœåŠ¡å•†é”å®š** ï¼šé¿å…è¢«å•ä¸€AIæœåŠ¡æä¾›å•†é”å®š
* **ç®—æ³•åˆ‡æ¢** ï¼šç®€åŒ–ä¸åŒAIæœåŠ¡ä¹‹é—´çš„åˆ‡æ¢
* **ä»£ç è†¨èƒ€** ï¼šé¿å…å› å¤šç§ç®—æ³•å¯¼è‡´çš„ä»£ç è†¨èƒ€

# è®¾è®¡æ€æƒ³æ€»ç»“

## å•ä¸€èŒè´£åŸåˆ™(SRP)

æ¯**ä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ** ï¼Œå³ä¸€ä¸ªç±»åªåº”è¯¥æœ‰ä¸€ä¸ªèŒè´£ã€‚æ¯ä¸ªç±»éƒ½åº”è¯¥ä¸“æ³¨äºåšå¥½ä¸€ä»¶äº‹æƒ…ã€‚

![1749457159222](image/è½¯ä»¶è®¾è®¡æ–‡æ¡£/1749457159222.png)

è‰¯å¥½ç¤ºä¾‹ï¼š

> BlogController - ä¸“æ³¨äºHTTPè¯·æ±‚å¤„ç†

```java
@RestController
@RequestMapping("/api/blogs")
public class BlogController {
    // å•ä¸€èŒè´£ï¼šä»…å¤„ç†HTTPè¯·æ±‚å’Œå“åº”
    @GetMapping
    public ResponseEntity<List<Blog>> getAllBlogs() { ... }
  
    @PostMapping
    public ResponseEntity<Blog> createBlog(@RequestBody Blog blog) { ... }
  
    @DeleteMapping("/{filename}")
    public ResponseEntity<String> deleteBlog(@PathVariable String filename) { ... }
}
```

ConfigService - ä¸“æ³¨äºé…ç½®ç®¡ç†

```java
@Configuration
public class ConfigService {
    // å•ä¸€èŒè´£ï¼šåº”ç”¨ç¨‹åºé…ç½®çš„åŠ è½½ã€éªŒè¯å’Œç®¡ç†
    @PostConstruct
    public void loadConfig() { ... }
  
    public Config getConfig() { return config; }
  
    public void saveConfig(Config config) throws IOException { ... }
  
    private void validateConfig(Config config) { ... }
}
```

#### âœ… SRPåœ¨é¡¹ç›®ä¸­çš„ä¼˜åŠ¿ä½“ç°

* **é«˜å†…èš** ï¼šæ¯ä¸ªç±»çš„åŠŸèƒ½é«˜åº¦é›†ä¸­ï¼Œå¦‚BlogControlleråªå¤„ç†Webå±‚é€»è¾‘
* **æ˜“ç»´æŠ¤** ï¼šä¿®æ”¹æ–‡ä»¶æ“ä½œé€»è¾‘åªéœ€æ”¹BlogFileServiceï¼Œä¸å½±å“Controller
* **å¯æµ‹è¯•** ï¼šæ¯ä¸ªç±»éƒ½å¯ä»¥ç‹¬ç«‹è¿›è¡Œå•å…ƒæµ‹è¯•
* **èŒè´£æ˜ç¡®** ï¼šå¼€å‘è€…å¯ä»¥å¿«é€Ÿå®šä½åŠŸèƒ½æ¨¡å—

## å¼€é—­åŸåˆ™(OCP)

**è½¯ä»¶å®ä½“åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­** ã€‚å³åœ¨ä¸ä¿®æ”¹ç°æœ‰ä»£ç çš„å‰æä¸‹ï¼Œé€šè¿‡æ‰©å±•æ¥å®ç°æ–°åŠŸèƒ½ã€‚

![1749457817218](image/è½¯ä»¶è®¾è®¡æ–‡æ¡£/1749457817218.png)

### å®ç°ç¤ºä¾‹

> LLMæŠ½è±¡åŸºç±» - å¯¹æ‰©å±•å¼€æ”¾

```java
public abstract class LLM {
    protected String APIKey;
    protected String APIUrl;
    protected String model;
    protected ArrayList<POSTMessage> messagesArray;
  
    public LLM(String APIKey, String APIUrl, String model) {
        // åŸºç¡€åŠŸèƒ½å®ç°
    }
  
    // æŠ½è±¡æ–¹æ³•ï¼šå¯¹æ‰©å±•å¼€æ”¾
    public abstract void callLLM(String prompt, String content, StreamCallback callback);
  
    // é€šç”¨æ–¹æ³•ï¼šå¯¹ä¿®æ”¹å°é—­
    public String getAPIKey() { return APIKey; }
    public void setAPIKey(String APIKey) { this.APIKey = APIKey; }
}
```

> BigModelå…·ä½“å®ç°-æ‰©å±•è€Œéä¿®æ”¹

```java
public class BigModel extends LLM {
    private static final Logger logger = LoggerFactory.getLogger(BigModel.class);
  
    public BigModel(String APIKey, String APIUrl, String model) {
        super(APIKey, APIUrl, model);  // å¤ç”¨åŸºç±»åŠŸèƒ½
    }
  
    @Override
    public void callLLM(String prompt, String content, StreamCallback callback) {
        // æ™ºè°±AIç‰¹å®šçš„å®ç°é€»è¾‘
        // æ— éœ€ä¿®æ”¹LLMåŸºç±»
        try {
            POSTMessage message = new POSTMessage("user", prompt + content);
            // ... å…·ä½“å®ç°
        } catch (Exception e) {
            callback.onError("è°ƒç”¨LLMæ—¶å‘ç”Ÿé”™è¯¯: " + e.getMessage());
        }
    }
}
```

> å·¥å‚æ¨¡å¼æ”¯æŒ-æ‰©å±•æ–°æ¨¡å‹

```java
public interface FactoryInterface {
    LLM createLLM(String APIKey, String APIUrl, String model);
}

public class BigModelFactory implements FactoryInterface {
    @Override
    public LLM createLLM(String APIKey, String APIUrl, String model) {
        return new BigModel(APIKey, APIUrl, model);
    }
}

// æ–°å¢æ¨¡å‹æ—¶ï¼Œåªéœ€æ·»åŠ æ–°çš„å·¥å‚å®ç°ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 
public class NewAIModelFactory implements FactoryInterface {
    @Override
    public LLM createLLM(String APIKey, String APIUrl, String model) {
        return new NewAIModel(APIKey, APIUrl, model);
    }
}
```

#### OCPåœ¨é¡¹ç›®ä¸­çš„ä¼˜åŠ¿ä½“ç°

* **æ‰©å±•æ€§å¼º** ï¼šæ–°å¢AIæ¨¡å‹æ— éœ€ä¿®æ”¹ç°æœ‰LLMä»£ç 
* **ç¨³å®šæ€§å¥½** ï¼šç°æœ‰åŠŸèƒ½ä¸å—æ–°åŠŸèƒ½å½±å“
* **ç»´æŠ¤ç®€å•** ï¼šæ–°åŠŸèƒ½ç‹¬ç«‹å¼€å‘å’Œæµ‹è¯•
* **å‘åå…¼å®¹** ï¼šç³»ç»Ÿå‡çº§ä¸ç ´åç°æœ‰åŠŸèƒ½

## é‡Œæ°æ›¿æ¢åŸåˆ™ (Liskov Substitution Principle, LSP)

![1749458596657](image/è½¯ä»¶è®¾è®¡æ–‡æ¡£/1749458596657.png)

> StreamCallbackæ¥å£å¥‘çº¦

```java
jpublic interface StreamCallback {
    /**
     * å¤„ç†æµå¼è¾“å‡ºçš„å›è°ƒæ–¹æ³•
     * å¥‘çº¦ï¼šchunkä¸ä¸ºnullï¼ŒisDoneè¡¨ç¤ºæ˜¯å¦å®Œæˆ
     */
    void onResponse(String chunk, boolean isDone);
  
    /**
     * é”™è¯¯å¤„ç†å›è°ƒæ–¹æ³•
     * å¥‘çº¦ï¼šerrorä¸ä¸ºnullä¸”åŒ…å«é”™è¯¯æè¿°
     */
    void onError(String error);
}

// åœ¨Controllerä¸­çš„ä½¿ç”¨ - å®Œå…¨å¯æ›¿æ¢
public void processLLMRequest(LLM llmInstance) {
    // æ— è®ºä¼ å…¥BigModelè¿˜æ˜¯XModelï¼Œéƒ½èƒ½æ­£å¸¸å·¥ä½œ
    llmInstance.callLLM(prompt, content, new StreamCallback() {
        @Override
        public void onResponse(String chunk, boolean isDone) {
            // å¤„ç†å“åº”
        }
  
        @Override
        public void onError(String error) {
            // å¤„ç†é”™è¯¯
        }
    });
}
```

#### LSPåœ¨é¡¹ç›®ä¸­çš„ä¼˜åŠ¿ä½“ç°

* **å®Œå…¨å¯æ›¿æ¢** ï¼šBigModelå’ŒXModelåœ¨å®¢æˆ·ç«¯ä»£ç ä¸­å®Œå…¨å¯äº’æ¢
* **è¡Œä¸ºä¸€è‡´æ€§** ï¼šæ‰€æœ‰LLMå®ç°éƒ½éµå¾ªç›¸åŒçš„è°ƒç”¨å¥‘çº¦
* **å¤šæ€æ”¯æŒ** ï¼šæ”¯æŒè¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©ä¸åŒçš„AIæ¨¡å‹
* **æµ‹è¯•å‹å¥½** ï¼šå¯ä»¥ç”¨Mockå¯¹è±¡æ›¿æ¢çœŸå®å®ç°è¿›è¡Œæµ‹è¯•

## æ¥å£éš”ç¦»åŸåˆ™

**ä¸åº”è¯¥å¼ºè¿«å®¢æˆ·ç«¯ä¾èµ–å®ƒä»¬ä¸ä½¿ç”¨çš„æ¥å£** ã€‚åº”è¯¥ä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£ï¼Œè€Œä¸æ˜¯å•ä¸€çš„æ€»æ¥å£ã€‚

![1749459129319](image/è½¯ä»¶è®¾è®¡æ–‡æ¡£/1749459129319.png)

#### âœ… ISPåœ¨é¡¹ç›®ä¸­çš„ä¼˜åŠ¿ä½“ç°

* **æœ€å°ä¾èµ–** ï¼šæ¯ä¸ªå®¢æˆ·ç«¯åªä¾èµ–å®ƒçœŸæ­£éœ€è¦çš„æ¥å£æ–¹æ³•
* **é«˜åº¦èšç„¦** ï¼šæ¥å£èŒè´£å•ä¸€ï¼Œæ˜“äºç†è§£å’Œå®ç°
* **å˜æ›´éš”ç¦»** ï¼šæŸä¸ªæ¥å£çš„å˜æ›´ä¸ä¼šå½±å“å…¶ä»–æ— å…³å®¢æˆ·ç«¯
* **å®ç°ç®€å•** ï¼šå®ç°ç±»æ— éœ€æä¾›æ— å…³åŠŸèƒ½çš„ç©ºå®ç°

# ç³»ç»Ÿæµç¨‹å›¾

## ç”¨æˆ·è®¤è¯æµç¨‹å›¾

![1750494401014](image/è½¯ä»¶è®¾è®¡æ–‡æ¡£/1750494401014.png)

## åšå®¢æ–‡ç« ç®¡ç†æµç¨‹å›¾

![1750494448895](image/è½¯ä»¶è®¾è®¡æ–‡æ¡£/1750494448895.png)

## LLMé›†æˆæµç¨‹å›¾

![1749461897696](image/è½¯ä»¶è®¾è®¡æ–‡æ¡£/1749461897696.png)

## æ•°æ®åº“è®¾è®¡

![1750494549245](image/è½¯ä»¶è®¾è®¡æ–‡æ¡£/1750494549245.png)
