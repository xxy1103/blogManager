# 博客管理系统 - 模块类图

## 1. 核心数据模型模块 (Model Module)

```mermaid
classDiagram
    class Blog {
        -Path filepath
        -String filename
        -String title
        -LocalDateTime dateTime
        -String categories
        -String[] tags
        -String saying
        -String content
        -DateTimeFormatter formatter$
        -DateTimeFormatter formatterPrint$
        +clone() Blog
        +equals(Object) boolean
        +compareTo(Blog) int
        +getters/setters()
        +loadFromFile(Path) Blog
        +parseYamlFrontMatter(String) void
        +parseFrontMatterValue(String, String) void
        +saveToFile() void
        +toString() String
    }
  
    class Message {
        -int status
        -Object data
        -String error
        +Message(int, Object, String)
        +getStatus() int
        +getData() Object
        +getError() String
    }
  
    Blog --|> Comparable : implements
    Blog --|> Cloneable : implements
```

## 2. 配置管理模块 (Configuration Module)

```mermaid
classDiagram
    class Config {
        -String blogStoragePath
        -String imageStoragePath
        -String xmodelAPIKey
        -String bigmodelAPIKey
        +getXmodelAPIKey() String
        +setXmodelAPIKey(String) void
        +getBigmodelAPIKey() String
        +setBigmodelAPIKey(String) void
        +getBlogStoragePath() String
        +setBlogStoragePath(String) void
        +getImageStoragePath() String
        +setImageStoragePath(String) void
    }
  
    class ConfigService {
        -Path configPath
        -Config config
        -Logger logger$
        +ConfigService(String)
        +loadConfig() void
        +saveConfig() void
        +getConfig() Config
        +setConfig(Config) void
        +createDefaultConfig() Config
    }
  
    ConfigService --> Config : manages
    ConfigService : <<@Configuration>>
```

## 3. 数据访问层模块 (Repository Module)

```mermaid
classDiagram
    class BlogFileService {
        -Logger logger$
        -Path storageLocation
        -Config config
        +BlogFileService(Config)
        +init() void
        +loadAllBlogs() List~Blog~
        +saveBlog(Blog) void
        +deleteBlog(String) boolean
        +findBlogByFilename(String) Blog
        +searchBlogs(String) List~Blog~
        +updateBlog(Blog) void
        +getBlogContent(String) String
        +validateBlogPath(Path) Path
        +sortBlogsByDateTime(List~Blog~) List~Blog~
    }
  
    BlogFileService --> Config : uses
    BlogFileService --> Blog : manages
    BlogFileService : <<@Service>>
```

## 4. 控制器层模块 (Controller Module)

```mermaid
classDiagram
    class BlogController {
        -Logger logger$
        -BlogFileService blogFileService
        -List~Blog~ blogList
        +BlogController(BlogFileService)
        +searchBydata(Blog) Blog
        +getAllBlogs() Message
        +getBlogByDatetime(String) Message
        +getBlogByFilename(String) Message
        +createBlog(Blog) Message
        +updateBlog(String, Blog) Message
        +deleteBlog(String) Message
        +searchBlogs(String) Message
    }
  
    class LLMController {
        -Logger logger$
        -LLM llm
        -Config config
        -ExecutorService executorService
        +chat(String, String, String) SseEmitter
        +chatWithBigModel(String, String) SseEmitter
        +chatWithXModel(String, String) SseEmitter
        +createStreamCallback(SseEmitter) StreamCallback
    }
  
    class ImageController {
        -Logger logger$
        -Config config
        +uploadImage(MultipartFile) Message
        +getImage(String) ResponseEntity
        +deleteImage(String) Message
        +listImages() Message
    }
  
    class ConfigController {
        -Logger logger$
        -ConfigService configService
        +getConfig() Message
        +updateConfig(Config) Message
        +resetConfig() Message
    }
  
    BlogController --> BlogFileService : uses
    BlogController --> Blog : manages
    BlogController --> Message : returns
    LLMController --> Config : uses
    ImageController --> Config : uses
    ConfigController --> ConfigService : uses
    ConfigController --> Config : manages
  
    BlogController : <<@RestController>>
    LLMController : <<@RestController>>
    ImageController : <<@RestController>>
    ConfigController : <<@RestController>>
```

## 5. LLM服务模块 (LLM Service Module)

```mermaid
classDiagram
    class LLM {
        <<abstract>>
        -String APIKey
        -String APIUrl
        -String model
        #ArrayList~POSTMessage~ messagesArray
        -Boolean IsStream
        -String temperature
        +LLM(String, String, String)
        +getters/setters()
        +callLLM(String, String, StreamCallback)* void
    }
  
    class BigModel {
        -Logger logger$
        +BigModel(String, String, String)
        +callLLM(String, String, StreamCallback) void
        -sendRequest(BigModelPOST, StreamCallback) void
        -handleStreamResponse(BufferedReader, StreamCallback) void
    }
  
    class XModel {
        -Logger logger$
        +XModel(String, String, String)
        +callLLM(String, String, StreamCallback) void
        -sendRequest(POST, StreamCallback) void
        -handleStreamResponse(BufferedReader, StreamCallback) void
    }
  
    class BigModelPOST {
        -String temperature
        +BigModelPOST(String, Boolean, String, POSTMessage[])
        +getTemperature() String
        +setTemperature(String) void
    }
  
    BigModel --|> LLM : extends
    XModel --|> LLM : extends
    BigModel --> BigModelPOST : uses
    XModel --> POST : uses
    BigModel : <<@Service>>
    XModel : <<@Service>>
```

## 6. LLM工厂模式模块 (LLM Factory Module)

```mermaid
classDiagram
    class FactoryInterface {
        <<interface>>
        +createLLM() LLM
    }
  
    class BigModelFactory {
        -Config config
        +BigModelFactory(Config)
        +createLLM() LLM
    }
  
    class XModelFactory {
        -Config config
        +XModelFactory(Config)
        +createLLM() LLM
    }
  
    BigModelFactory --|> FactoryInterface : implements
    XModelFactory --|> FactoryInterface : implements
    BigModelFactory --> Config : uses
    XModelFactory --> Config : uses
    BigModelFactory --> BigModel : creates
    XModelFactory --> XModel : creates
```

## 7. LLM通信模块 (LLM Communication Module)

```mermaid
classDiagram
    class POST {
        -String model
        -Boolean stream
        -POSTMessage[] messages
        +POST(String, Boolean, POSTMessage[])
        +getters/setters()
    }
  
    class POSTMessage {
        -String role
        -String content
        +POSTMessage(String, String)
        +getRole() String
        +setRole(String) void
        +getContent() String
        +setContent(String) void
    }
  
    class StreamCallback {
        <<interface>>
        +onData(String) void
        +onError(String) void
        +onComplete() void
    }
  
    class Prompt {
        +SYSTEM_PROMPT$ String
        +USER_PROMPT$ String
        +generatePrompt(String, String) String
        +formatContent(String) String
    }
  
    POST --> POSTMessage : contains
    LLM --> StreamCallback : uses
    LLM --> Prompt : uses
```

## 8. 主应用程序模块 (Main Application Module)

```mermaid
classDiagram
    class BlogManagerApplication {
        +main(String[]) void
    }
  
    BlogManagerApplication : <<@SpringBootApplication>>
```

## 模块间依赖关系图

```mermaid
graph TD
    A[BlogManagerApplication] --> B[Controller Module]
    B --> C[Repository Module]
    B --> D[LLM Service Module]
    B --> E[Configuration Module]
    C --> F[Model Module]
    D --> G[LLM Factory Module]
    D --> H[LLM Communication Module]
    E --> F
    G --> D
    G --> E
  
    subgraph "表现层"
        B
    end
  
    subgraph "业务逻辑层"
        C
        D
        G
        H
    end
  
    subgraph "数据层"
        F
        E
    end
```

## 关键设计模式

1. **工厂模式**: `FactoryInterface`, `BigModelFactory`, `XModelFactory`
2. **模板方法模式**: `LLM`抽象类
3. **回调模式**: `StreamCallback`接口
4. **依赖注入**: Spring框架的 `@Autowired`注解
5. **MVC模式**: Controller-Service-Repository架构
